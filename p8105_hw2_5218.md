p8105_hw2_ml5218
================
Muying Li
2025-09-29

Load packages

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(readxl)
```

# Problem 1

## Data Wrangling

Tidy `pols-month.csv`

``` r
pols = 
  read_csv('data/fivethirtyeight_datasets/pols-month.csv') |> 
  janitor::clean_names() |> 
  # break up the variable mon into integer variables year, month, and day
  separate(
    mon, sep="-", into=c("year", "month", "day")
  ) |> 
  # convert into integer variables
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day)
  ) |> 
  # replace month number with month name
  mutate(
    month = case_when(
      month == 1 ~ "January",
      month == 2 ~ "February",
      month == 3 ~ "March",
      month == 4 ~ "April",
      month == 5 ~ "May",
      month == 6 ~ "June",
      month == 7 ~ "July",
      month == 8 ~ "August",
      month == 9 ~ "September",
      month == 10 ~ "October",
      month == 11 ~ "November",
      month == 12 ~ "December"
    )
  ) |> 
  # create a president variable taking values gop and dem
  mutate(
    president = case_when(
      prez_gop > prez_dem ~ "gop",
      prez_dem > prez_gop ~ "dem"
    )
  )|> 
  # remove prez_dem and prez_gop, remove the day variable
  select(-prez_dem, -prez_gop, -day) 
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Tidy `unemployment.csv`

``` r
unemployment = 
  read_csv('data/fivethirtyeight_datasets/unemployment.csv') |> 
  janitor::clean_names() |>
  # tidy the data
  pivot_longer(
    cols = jan:dec,
    names_to = "month",
    values_to = "unemployment_rate"
  ) |> 
  # convert year to integer
  mutate(year = as.integer(year)) |> 
  # replace month abbreviation with month name
  mutate(
    month = case_when(
      month == "jan" ~ "January",
      month == "feb" ~ "February",
      month == "mar" ~ "March",
      month == "apr" ~ "April",
      month == "may" ~ "May",
      month == "jun" ~ "June",
      month == "jul" ~ "July",
      month == "aug" ~ "August",
      month == "sep" ~ "September",
      month == "oct" ~ "October",
      month == "nov" ~ "November",
      month == "dec" ~ "December"
    ),
  ) |>
  # arrange according to year and month
  mutate(month = factor(month, levels = month.name)) |> 
  arrange(year, month) |> 
  # make year and month are the leading columns
  relocate(year, month)
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Tidy `snp.csv`

``` r
snp = 
  read_csv('data/fivethirtyeight_datasets/snp.csv') |> 
  janitor::clean_names() |> 
  # break up the variable mon into integer variables year, month, and day
  separate(
    date, sep="/", into=c("month", "day", "year")
  ) |> 
  # convert into integer variables
  mutate(
    year = as.integer(year),
    month = as.integer(month)
  ) |> 
  # replace month number with month name
  mutate(
    month = case_when(
      month == 1 ~ "January",
      month == 2 ~ "February",
      month == 3 ~ "March",
      month == 4 ~ "April",
      month == 5 ~ "May",
      month == 6 ~ "June",
      month == 7 ~ "July",
      month == 8 ~ "August",
      month == 9 ~ "September",
      month == 10 ~ "October",
      month == 11 ~ "November",
      month == 12 ~ "December"
    )
  ) |> 
  # convert year to yyyy format
  mutate(
    year = case_when(
      year <= 25 ~ year+2000,
      year > 25 ~ year+1900
    )
  ) |> 
  # arrange according to year and month
  mutate(month = factor(month, levels = month.name)) |> 
  arrange(year, month) |> 
  # make year and month are the leading columns
  relocate(year, month) |> 
  # remove day 
  select(-day)
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Join the datasets by merging `snp` into `pols`, and merging
`unemployment` into the result.

``` r
result = 
  left_join(pols, snp, by = c("year", "month")) |> 
  left_join(unemployment, by = c("year", "month"))
result
```

    ## # A tibble: 822 × 11
    ##     year month   gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president close
    ##    <dbl> <chr>     <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>     <dbl>
    ##  1  1947 January      23      51     253      23      45     198 dem          NA
    ##  2  1947 Februa…      23      51     253      23      45     198 dem          NA
    ##  3  1947 March        23      51     253      23      45     198 dem          NA
    ##  4  1947 April        23      51     253      23      45     198 dem          NA
    ##  5  1947 May          23      51     253      23      45     198 dem          NA
    ##  6  1947 June         23      51     253      23      45     198 dem          NA
    ##  7  1947 July         23      51     253      23      45     198 dem          NA
    ##  8  1947 August       23      51     253      23      45     198 dem          NA
    ##  9  1947 Septem…      23      51     253      23      45     198 dem          NA
    ## 10  1947 October      23      51     253      23      45     198 dem          NA
    ## # ℹ 812 more rows
    ## # ℹ 1 more variable: unemployment_rate <dbl>

## Description about the Datasets

Basic summary

``` r
# dimensions of the dataset
dim(result)
# structure of the dataset
str(result)
# missing values
colSums(is.na(result))
# summary statistics
summary(result)
```

*Write a short paragraph about these datasets. Explain briefly what each
dataset contained, and describe the resulting dataset (e.g. give the
dimension, range of years, and names of key variables).*

### `pols`

`pols` (from `pols-month.csv`) contains 822 observations of 9 variables
related to the number of national politicians who are democratic or
republican in a specific month of the associated year from 1947 to 2015:

- `year`: year of the count on that row
- `month`: month of the count on that row
- `gov_gop`, `sen_gop`, `rep_gop`: the number of Republican Party
  representatives in government, Senate, and House, respectively on the
  associated month and year
- `gov_dem`, `sen_dem`, `rep_dem`: the number of Democratic Party
  representatives in government, Senate, and House, respectively on the
  associated month and year
- `president`: political affiliation of the U.S. president on the
  associated month and year (`dem` = democratic, `gop` = republican)

This dataset contains 0, 0, 0, 0, 0, 0, 0, 0, 0 missing values in
columns year, month, gov_gop, sen_gop, rep_gop, gov_dem, sen_dem,
rep_dem, president respectively, indicating no missing values.

### `unemployment`

`unemployment` (from `unemployment.csv`) contains 816 observations of 3
variables related to percentage of unemployment in a specific month of
the associated year from 1948 to 2015:

- `year`: year of the measurements on that row
- `month`: month of the count on that row
- `unemployment_rate`: percentage of unemployment of the associated year
  and month

However, this dataset contains 0, 0, 6 missing values in columns year,
month, unemployment_rate respectively, corresponding to no records of
unemployment rate from July 2015 to December 2015.

### `snp`

`snp` (from `snp.csv`) contains 787 observations of 3 variables related
to Standard & Poor’s stock market index (S&P) in a specific month of the
associated year from 1950 to 2015:

- `year`: year of the measurements on that row
- `month`: month of the measurements on that row
- `close`: the closing values of the S&P stock index on the associated
  year and month

This dataset contains 0, 0, 0 missing values in columns year, month,
close respectively, indicating no missing values.

### Merged dataset `result`

`result` includes merged data from `unemployment` and `snp` into `pols`.
Therefore, it contains information on political party representation,
the closing values of the S&P stock index, and the percentage of
unemployment, from January 1947 to June 2015 (same range as `pols`). It
includes a total of 822 rows/observations and 11 columns/variables as
described above.

# Problem 2

## Data Wrangling

Mr. Trash Wheel

``` r
mr_trash = 
  read_excel(
    "data/202409 Trash Wheel Collection Data.xlsx", 
    sheet = "Mr. Trash Wheel",
    range = "A2:N653"
    ) |> 
  janitor::clean_names() |> 
  # no need date
  select(-date) |> 
  # add name of the wheel
  mutate(
    wheel = "mr"
  ) |> 
  # round sports balls to the nearest integer and converts the result to an integer variable 
  mutate(sports_balls = as.integer(round(sports_balls))) |> 
  # pivot the data longer for types of trash
  pivot_longer(
    cols = plastic_bottles:sports_balls,
    names_to = "trash_type",
    values_to = "count"
  ) |> 
  # pivot the data longer for weight and volume 
  pivot_longer(
    cols = weight_tons:volume_cubic_yards,
    names_to = "measurement_type",
    values_to = "value"
  ) |> 
  # move homes to the last column 
  relocate(homes_powered, .after = last_col()) |> 
  # convert year and month to integer and factor
  mutate(
    month = str_to_title(month),
    month = factor(month, levels = month.name),
    year = as.integer(year)
  )
mr_trash
```

    ## # A tibble: 9,114 × 9
    ##    dumpster month  year wheel trash_type       count measurement_type   value
    ##       <dbl> <fct> <int> <chr> <chr>            <dbl> <chr>              <dbl>
    ##  1        1 May    2014 mr    plastic_bottles   1450 weight_tons         4.31
    ##  2        1 May    2014 mr    plastic_bottles   1450 volume_cubic_yards 18   
    ##  3        1 May    2014 mr    polystyrene       1820 weight_tons         4.31
    ##  4        1 May    2014 mr    polystyrene       1820 volume_cubic_yards 18   
    ##  5        1 May    2014 mr    cigarette_butts 126000 weight_tons         4.31
    ##  6        1 May    2014 mr    cigarette_butts 126000 volume_cubic_yards 18   
    ##  7        1 May    2014 mr    glass_bottles       72 weight_tons         4.31
    ##  8        1 May    2014 mr    glass_bottles       72 volume_cubic_yards 18   
    ##  9        1 May    2014 mr    plastic_bags       584 weight_tons         4.31
    ## 10        1 May    2014 mr    plastic_bags       584 volume_cubic_yards 18   
    ## # ℹ 9,104 more rows
    ## # ℹ 1 more variable: homes_powered <dbl>

``` r
filter(mr_trash, is.na(year) | is.na(month))
```

    ## # A tibble: 0 × 9
    ## # ℹ 9 variables: dumpster <dbl>, month <fct>, year <int>, wheel <chr>,
    ## #   trash_type <chr>, count <dbl>, measurement_type <chr>, value <dbl>,
    ## #   homes_powered <dbl>

Professor Trash Wheel

``` r
prof_trash = 
  read_excel(
    "data/202409 Trash Wheel Collection Data.xlsx", 
    sheet = "Professor Trash Wheel",
    range = "A2:M121"
    ) |> 
  janitor::clean_names() |> 
  # no need date
  select(-date) |> 
  # add name of the wheel
  mutate(
    wheel = "prof"
  ) |> 
  # pivot the data longer for types of trash
  pivot_longer(
    cols = plastic_bottles:wrappers,
    names_to = "trash_type",
    values_to = "count"
  ) |> 
  # pivot the data longer for weight and volume 
  pivot_longer(
    cols = weight_tons:volume_cubic_yards,
    names_to = "measurement_type",
    values_to = "value"
  ) |> 
  # move homes to the last column 
  relocate(homes_powered, .after = last_col()) |> 
  # convert year and month to integer and factor
  mutate(
    month = str_to_title(month),
    month = factor(month, levels = month.name),
    year = as.integer(year)
  ) |> 
  # only keep non-empty rows
  filter(!is.na(year))

prof_trash
```

    ## # A tibble: 1,416 × 9
    ##    dumpster month    year wheel trash_type      count measurement_type   value
    ##       <dbl> <fct>   <int> <chr> <chr>           <dbl> <chr>              <dbl>
    ##  1        1 January  2017 prof  plastic_bottles  1950 weight_tons         1.79
    ##  2        1 January  2017 prof  plastic_bottles  1950 volume_cubic_yards 15   
    ##  3        1 January  2017 prof  polystyrene      6080 weight_tons         1.79
    ##  4        1 January  2017 prof  polystyrene      6080 volume_cubic_yards 15   
    ##  5        1 January  2017 prof  cigarette_butts 19700 weight_tons         1.79
    ##  6        1 January  2017 prof  cigarette_butts 19700 volume_cubic_yards 15   
    ##  7        1 January  2017 prof  glass_bottles       8 weight_tons         1.79
    ##  8        1 January  2017 prof  glass_bottles       8 volume_cubic_yards 15   
    ##  9        1 January  2017 prof  plastic_bags     3100 weight_tons         1.79
    ## 10        1 January  2017 prof  plastic_bags     3100 volume_cubic_yards 15   
    ## # ℹ 1,406 more rows
    ## # ℹ 1 more variable: homes_powered <dbl>

Gwynnda

``` r
gwy_trash = 
  read_excel(
    "data/202409 Trash Wheel Collection Data.xlsx", 
    sheet = "Gwynnda Trash Wheel",
    range = "A2:L265"
    ) |> 
  janitor::clean_names() |> 
  # no need date
  select(-date) |> 
  # add name of the wheel
  mutate(
    wheel = "gwy"
  ) |> 
  # pivot the data longer for types of trash
  pivot_longer(
    cols = plastic_bottles:wrappers,
    names_to = "trash_type",
    values_to = "count"
  ) |> 
  # pivot the data longer for weight and volume 
  pivot_longer(
    cols = weight_tons:volume_cubic_yards,
    names_to = "measurement_type",
    values_to = "value"
  ) |> 
  # move homes to the last column 
  relocate(homes_powered, .after = last_col()) |> 
  # convert year and month to integer and factor
  mutate(
    month = str_to_title(month),
    month = factor(month, levels = month.name),
    year = as.integer(year)
  )
gwy_trash
```

    ## # A tibble: 2,630 × 9
    ##    dumpster month  year wheel trash_type      count measurement_type   value
    ##       <dbl> <fct> <int> <chr> <chr>           <dbl> <chr>              <dbl>
    ##  1        1 July   2021 gwy   plastic_bottles  1200 weight_tons         0.93
    ##  2        1 July   2021 gwy   plastic_bottles  1200 volume_cubic_yards 15   
    ##  3        1 July   2021 gwy   polystyrene       360 weight_tons         0.93
    ##  4        1 July   2021 gwy   polystyrene       360 volume_cubic_yards 15   
    ##  5        1 July   2021 gwy   cigarette_butts  3400 weight_tons         0.93
    ##  6        1 July   2021 gwy   cigarette_butts  3400 volume_cubic_yards 15   
    ##  7        1 July   2021 gwy   plastic_bags     1800 weight_tons         0.93
    ##  8        1 July   2021 gwy   plastic_bags     1800 volume_cubic_yards 15   
    ##  9        1 July   2021 gwy   wrappers           NA weight_tons         0.93
    ## 10        1 July   2021 gwy   wrappers           NA volume_cubic_yards 15   
    ## # ℹ 2,620 more rows
    ## # ℹ 1 more variable: homes_powered <dbl>

Combine this with the 3 wheel datasets

``` r
wheels = 
  bind_rows(mr_trash, prof_trash, gwy_trash) |> 
  # move wheel, year, month as leading columns 
  relocate(wheel, year, month)
```

## Description about `wheels`

*Write a paragraph about these data; you are encouraged to use inline R.
Be sure to note the number of observations in the resulting dataset, and
give examples of key variables.*

The `wheels` contains trash collection data of 3 wheels: Mr. Trash
Wheel, Professor Trash Wheel, and Gwynnda Trash Wheel, from 2014 to
2024. It includes a total of 13160 observations of 9 variables. Each
row/observation indicates the trash collection information of a specific
wheel’s dumpster in a month and a year such as amount of total litter
and litter type, and number of homes powered by the trash collected.

Key variables include:

- `wheel`: wheel identifier indicating which wheel the trash was
  collected from (`mr` = Mr. Trash, `prof` = Professor, `gwy` = Gwynnda)
- `year`: year the data was collected
- `month`: month the data was collected
- `dumpster`: dumpster number (in integer, starting from 1)
- `trash_type`: type of trash collected, including `plastic_bottles`,
  `polystyrene`, `cigarette_butts`, `glass_bottles`, `plastic_bags`,
  `wrappers`, `sports_balls`
- `count`: counts of how many of a specific trash type was collected (in
  integer)
- `measurement_type`: type of measurement of total trash collected (such
  as weight in tons (`weight_tons`) or volume in cubic yards
  (`volume_cubic_yards`))
- `value`: numeric value of a specific measurement type of total trash
  collected

*What was the total weight of trash collected by Professor Trash Wheel?*

``` r
prof_total_weight = 
  filter(
    wheels, 
    wheel == "prof", 
    measurement_type == "weight_tons"
  ) |> 
  select(value) |> 
  sum()
```

The total weight of trash collected by Professor Trash Wheel is 1480.44
tons.

*What was the total number of cigarette butts collected by Gwynnda in
June of 2022?*

``` r
gwy_jun22_cig = 
  filter(
    wheels, 
    wheel == "gwy", 
    trash_type == "cigarette_butts",
    year == 2022,
    month == "June"
  ) |> 
  select(count) |> 
  sum()
```

The total number of cigarette butts collected by Gwynnda in June of 2022
is 36240.

# Problem 3

## Data Wrangling

Zip code

``` r
zip_code =
  read_csv("data/zillow_data/Zip Codes.csv") |> 
  janitor::clean_names() |> 
  # add "County" to county 
  mutate(
    county = paste(county, "County")
  )
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
# find duplicate zip codes
#group_by(zip_code, zip_code) |> 
#  filter(n() > 1)
# remove duplicates
#zip_code = distinct(zip_code, zip_code, .keep_all = TRUE)
```

ZORI

``` r
zori = 
  read_csv("data/zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |> 
  janitor::clean_names() |> 
    # rename columns 
  rename(
    zip_code = region_name,
    county = county_name
  ) |> 
  # pivot date
  pivot_longer(
    cols = x2015_01_31:last_col(),
    names_to = "date",
    values_to = "rent",
    # remove prefix
    names_prefix = "x"
  ) |> 
  # extract year, month from date
  # break up the variable mon into integer variables year, month, and day
  separate(
    date, sep="_", into=c("year", "month", "day")
  ) |> 
  # convert into integer variables
  mutate(
    year = as.integer(year),
    month = as.integer(month)
  ) |> 
  # replace month number with month name
  mutate(
    month = case_when(
      month == 1 ~ "January",
      month == 2 ~ "February",
      month == 3 ~ "March",
      month == 4 ~ "April",
      month == 5 ~ "May",
      month == 6 ~ "June",
      month == 7 ~ "July",
      month == 8 ~ "August",
      month == 9 ~ "September",
      month == 10 ~ "October",
      month == 11 ~ "November",
      month == 12 ~ "December"
    )
  ) |> 
  mutate(month = factor(month, levels = month.name))
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Check for completeness and correctness across datasets

``` r
colSums(is.na(zip_code))
```

    ##       county   state_fips  county_code  county_fips     zip_code    file_date 
    ##            0            0            0            0            0            0 
    ## neighborhood 
    ##          142

``` r
colSums(is.na(zori))
```

    ##   region_id   size_rank    zip_code region_type  state_name       state 
    ##           0           0           0           0           0           0 
    ##        city       metro      county        year       month         day 
    ##           0           0           0           0           0           0 
    ##        rent 
    ##        6834

Note that in `zip_code`, there are 142 missing neighborhood values, and
in `zori`, there are 6834 missing rent values.

Check how many unique zip codes in zip_code and zori respectively:

- zip_code has 320
- zori has 149

Next

- Merge `zip_code` into `zori` by `zip_code` and `county` columns
- Pivot the date
- Arrange variables and observations in meaningful orders.

``` r
zori_nyc_zip = 
  left_join(zip_code,zori,by = c("zip_code","county")) |> 
  # rearrange columns
  relocate(zip_code, county, neighborhood, year, month, rent) |> 
  # no need day
  select(-day)
```

Not all columns are necessary in this case. Remove unnecessary columns
such as `state_fips`, `state_name`, `city`, `metro`, as all areas are
within NY.

``` r
tidy_zori_nyc = 
  select(zori_nyc_zip, zip_code, county, neighborhood, year, month, rent)
```

## Description & Question Answering

*Briefly describe the resulting tidy dataset. *

`zori_nyc_zip` contains data from datasets `zip_code` and `zori`,
including NYC zip code, neighborhoods within boroughs, and Zillow
Observed Rent Index (ZORI) between January 2015 and August 2024. It has
a total of 17342 observations of 17 variables.

`tidy_zori_nyc` is a subset of `zori_nyc_zip` containing only necessary
information about NYC zip codes, boroughs, neighborhoods, and ZORI. It
has a total of 17342 observations of 6 variables.

Key variables include:

- `zip_code`: zip code of a specific area/region
- `county`: county where the area/region belongs to
- `neighborhood`: neighborhoods within boroughs
- `year`: year of the data was collected
- `month`: month of the data was collected
- `rent`: zori index, a repeat-rent index that is weighted to the rental
  housing stock to ensure representativeness across the entire market

*How many total observations exist? How many unique ZIP codes are
included, and how many unique neighborhoods?*

- Total observations: 17342
- Number of unique zip codes: 320
- Number of unique neighborhoods: 43

*Which ZIP codes appear in the ZIP code dataset but not in the Zillow
Rental Price dataset? Using a few illustrative examples discuss why
these ZIP codes might be excluded from the Zillow dataset.*

``` r
exclusive_zip = anti_join(zip_code, zori, by = "zip_code") |> 
  arrange(zip_code) |> 
  pull(zip_code)
exclusive_zip
```

    ##   [1] 10008 10020 10041 10043 10045 10047 10048 10055 10072 10080 10081 10082
    ##  [13] 10087 10101 10102 10103 10104 10105 10106 10107 10108 10109 10110 10111
    ##  [25] 10112 10113 10114 10115 10116 10117 10118 10119 10120 10121 10122 10123
    ##  [37] 10124 10125 10126 10129 10130 10131 10132 10133 10138 10149 10150 10151
    ##  [49] 10152 10153 10154 10155 10156 10157 10158 10159 10160 10161 10163 10164
    ##  [61] 10165 10166 10167 10168 10169 10170 10171 10172 10173 10174 10175 10176
    ##  [73] 10177 10178 10179 10185 10197 10199 10213 10242 10249 10256 10259 10260
    ##  [85] 10261 10265 10268 10269 10270 10271 10272 10273 10274 10275 10276 10277
    ##  [97] 10278 10279 10281 10285 10286 10292 10302 10307 10309 10310 10311 10313
    ## [109] 10464 10474 10475 10499 10550 10704 10705 10803 11001 11004 11005 11040
    ## [121] 11096 11202 11224 11239 11241 11242 11243 11245 11247 11251 11252 11256
    ## [133] 11351 11352 11359 11362 11363 11371 11380 11381 11386 11405 11411 11412
    ## [145] 11413 11414 11416 11417 11419 11420 11421 11422 11423 11424 11425 11427
    ## [157] 11428 11429 11430 11431 11433 11436 11439 11451 11499 11559 11580 11690
    ## [169] 11694 11695 11697

There are 171 zip codes appear in the ZIP code dataset but not in the
Zillow Rental Price dataset.

Possible reasons for exclusion:

- Non-residential areas such as 10041 located in the Financial District
  of Manhattan, where mostly commercial buildings and minimal rental
  housing. These commerical, industrial, or non-residential regions have
  ZIP codes where Zillow does not track rental prices.
- Missing or insufficient price data for less populated or less active
  rental markets such as 11559 located in Long Island; it may have fewer
  rental listings available in Zillow’s dataset.
- Special cases like post office boxes, government buildings, or
  military facilities where rental properties might not be tracked; for
  example, 10199 corresponds to the postal code for USPS Morgan
  Processing and Distribution Center and does not include residential
  housing.

*Rental prices fluctuated dramatically during the COVID-19 pandemic. For
all available ZIP codes, compare rental prices in January 2021 to prices
in January 2020. Make a table that shows the 10 ZIP codes (along with
the borough and neighborhood) with largest drop in price from January
2020 to 2021. Comment.*

``` r
covid_prices = 
  filter(
    tidy_zori_nyc, 
    # January 2020 and January 2021
    (year == 2020 & month  == "January") | (year == 2021 & month == "January"),
    ) |> 
  pivot_wider(
    names_from = year,
    values_from = rent,
    names_prefix = "rent_"
    ) |> 
  filter(
    # available prices for both years
    !is.na(rent_2020) & !is.na(rent_2021)
  ) |> 
  # calculate price difference
  mutate(
    price_change = rent_2021-rent_2020
  ) |> 
  # order by biggest difference to smallest
  arrange(price_change)
```

Below is the table that shows the 10 ZIP codes (along with the borough
and neighborhood) with largest drop in price from January 2020 to 2021

``` r
# top 10 in table format with 10 ZIP codes 
select(covid_prices, zip_code, county, neighborhood, price_change) |> 
  head(10) |> 
  knitr::kable()
```

| zip_code | county          | neighborhood                  | price_change |
|---------:|:----------------|:------------------------------|-------------:|
|    10007 | New York County | Lower Manhattan               |    -912.5966 |
|    10069 | New York County | NA                            |    -748.1245 |
|    10009 | New York County | Lower East Side               |    -714.2550 |
|    10016 | New York County | Gramercy Park and Murray Hill |    -711.7045 |
|    10001 | New York County | Chelsea and Clinton           |    -710.4499 |
|    10002 | New York County | Lower East Side               |    -710.3028 |
|    10004 | New York County | Lower Manhattan               |    -705.9608 |
|    10038 | New York County | Lower Manhattan               |    -697.5853 |
|    10012 | New York County | Greenwich Village and Soho    |    -686.2218 |
|    10010 | New York County | Gramercy Park and Murray Hill |    -684.9304 |

If we don’t want empty neighborhood information, we can drop `NA` rows

``` r
select(covid_prices, zip_code, county, neighborhood, price_change) |> 
  filter(!is.na(neighborhood)) |> 
  head(10) |> 
  knitr::kable()
```

| zip_code | county          | neighborhood                  | price_change |
|---------:|:----------------|:------------------------------|-------------:|
|    10007 | New York County | Lower Manhattan               |    -912.5966 |
|    10009 | New York County | Lower East Side               |    -714.2550 |
|    10016 | New York County | Gramercy Park and Murray Hill |    -711.7045 |
|    10001 | New York County | Chelsea and Clinton           |    -710.4499 |
|    10002 | New York County | Lower East Side               |    -710.3028 |
|    10004 | New York County | Lower Manhattan               |    -705.9608 |
|    10038 | New York County | Lower Manhattan               |    -697.5853 |
|    10012 | New York County | Greenwich Village and Soho    |    -686.2218 |
|    10010 | New York County | Gramercy Park and Murray Hill |    -684.9304 |
|    10003 | New York County | Lower East Side               |    -672.5404 |

From the table above, with top 10 zip codes with the largest price
change for rental prices, we can find that:

1.  All top 10 price drops in rental prices from January 2020 to January
    2021 were from New York County with a highest price drop of
    \$912.5966 at 10007, Lower Manhattan.

2.  The neighborhoods in top 10 are primarily in Lower Manhattan (6 out
    of 10), followed by Gramercy Park (2 out of 10).

3.  We can take a further look into the price changes by neighborhood.
    The results of code below show that the highest mean price drop area
    is Lower East Side followed by Lower Manhattan, which indicates
    people moved out from these areas, while Jamaica area had a mean
    rental price increase at \$101; perhaps people were moving out from
    the city to nearby areas like Jamaica.

``` r
# calculate mean price_change for each neighborhood
mean_price_change_by_neighborhood <- 
  group_by(covid_prices, neighborhood) |> 
  summarise(mean_price_change = mean(price_change)) |> 
  arrange(mean_price_change)
mean_price_change_by_neighborhood
```

    ## # A tibble: 29 × 2
    ##    neighborhood                  mean_price_change
    ##    <chr>                                     <dbl>
    ##  1 Lower East Side                           -699.
    ##  2 Lower Manhattan                           -654.
    ##  3 Gramercy Park and Murray Hill             -634.
    ##  4 Greenwich Village and Soho                -633.
    ##  5 Chelsea and Clinton                       -623.
    ##  6 Upper West Side                           -514.
    ##  7 Upper East Side                           -478.
    ##  8 Bushwick and Williamsburg                 -337.
    ##  9 Greenpoint                                -330.
    ## 10 East Harlem                               -326.
    ## # ℹ 19 more rows

``` r
# arrange by descending order
arrange(mean_price_change_by_neighborhood, desc(mean_price_change))
```

    ## # A tibble: 29 × 2
    ##    neighborhood              mean_price_change
    ##    <chr>                                 <dbl>
    ##  1 Jamaica                              101.  
    ##  2 Bronx Park and Fordham                69.7 
    ##  3 Kingsbridge and Riverdale             36.5 
    ##  4 Sunset Park                            5.37
    ##  5 Southeast Bronx                        4.34
    ##  6 Central Bronx                         -1.85
    ##  7 Southwest Brooklyn                    -8.09
    ##  8 Southern Brooklyn                    -46.0 
    ##  9 North Queens                         -65.0 
    ## 10 Borough Park                        -117.  
    ## # ℹ 19 more rows
