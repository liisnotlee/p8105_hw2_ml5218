---
title: "p8105_hw2_ml5218"
author: "Muying Li"
date: "2025-09-29"
output: github_document
---


Load packages
```{r}
library(tidyverse)
library(readxl)
```

# Problem 1

## Data Wrangling
Tidy `pols-month.csv`
```{r}
pols = 
  read_csv('data/fivethirtyeight_datasets/pols-month.csv') |> 
  janitor::clean_names() |> 
  # break up the variable mon into integer variables year, month, and day
  separate(
    mon, sep="-", into=c("year", "month", "day")
  ) |> 
  # convert into integer variables
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day)
  ) |> 
  # replace month number with month name
  mutate(
    month = case_when(
      month == 1 ~ "January",
      month == 2 ~ "February",
      month == 3 ~ "March",
      month == 4 ~ "April",
      month == 5 ~ "May",
      month == 6 ~ "June",
      month == 7 ~ "July",
      month == 8 ~ "August",
      month == 9 ~ "September",
      month == 10 ~ "October",
      month == 11 ~ "November",
      month == 12 ~ "December"
    )
  ) |> 
  # create a president variable taking values gop and dem
  mutate(
    president = case_when(
      prez_gop > prez_dem ~ "gop",
      prez_dem > prez_gop ~ "dem"
    )
  )|> 
  # remove prez_dem and prez_gop, remove the day variable
  select(-prez_dem, -prez_gop, -day) 
```
Tidy `unemployment.csv`
```{r}
unemployment = 
  read_csv('data/fivethirtyeight_datasets/unemployment.csv') |> 
  janitor::clean_names() |>
  # tidy the data
  pivot_longer(
    cols = jan:dec,
    names_to = "month",
    values_to = "unemployment_rate"
  ) |> 
  # convert year to integer
  mutate(year = as.integer(year)) |> 
  # replace month abbreviation with month name
  mutate(
    month = case_when(
      month == "jan" ~ "January",
      month == "feb" ~ "February",
      month == "mar" ~ "March",
      month == "apr" ~ "April",
      month == "may" ~ "May",
      month == "jun" ~ "June",
      month == "jul" ~ "July",
      month == "aug" ~ "August",
      month == "sep" ~ "September",
      month == "oct" ~ "October",
      month == "nov" ~ "November",
      month == "dec" ~ "December"
    ),
  ) |>
  # arrange according to year and month
  mutate(month = factor(month, levels = month.name)) |> 
  arrange(year, month) |> 
  # make year and month are the leading columns
  relocate(year, month)
```
Tidy `snp.csv`
```{r}
snp = 
  read_csv('data/fivethirtyeight_datasets/snp.csv') |> 
  janitor::clean_names() |> 
  # break up the variable mon into integer variables year, month, and day
  separate(
    date, sep="/", into=c("month", "day", "year")
  ) |> 
  # convert into integer variables
  mutate(
    year = as.integer(year),
    month = as.integer(month)
  ) |> 
  # replace month number with month name
  mutate(
    month = case_when(
      month == 1 ~ "January",
      month == 2 ~ "February",
      month == 3 ~ "March",
      month == 4 ~ "April",
      month == 5 ~ "May",
      month == 6 ~ "June",
      month == 7 ~ "July",
      month == 8 ~ "August",
      month == 9 ~ "September",
      month == 10 ~ "October",
      month == 11 ~ "November",
      month == 12 ~ "December"
    )
  ) |> 
  # convert year to yyyy format
  mutate(
    year = case_when(
      year <= 25 ~ year+2000,
      year > 25 ~ year+1900
    )
  ) |> 
  # arrange according to year and month
  mutate(month = factor(month, levels = month.name)) |> 
  arrange(year, month) |> 
  # make year and month are the leading columns
  relocate(year, month) |> 
  # remove day 
  select(-day)
```

Join the datasets by merging `snp` into `pols`, and merging `unemployment` into the result.
```{r}
result = 
  left_join(pols, snp, by = c("year", "month")) |> 
  left_join(unemployment, by = c("year", "month"))
result
```

## Description about the Datasets
Basic summary
```{r eval = FALSE}
# dimensions of the dataset
dim(result)
# structure of the dataset
str(result)
# missing values
colSums(is.na(result))
# summary statistics
summary(result)
```

*Write a short paragraph about these datasets. Explain briefly what each dataset contained, and describe the resulting dataset (e.g. give the dimension, range of years, and names of key variables).*

### `pols`
`pols` (from `pols-month.csv`) contains `r nrow(pols)` observations of `r ncol(pols)` variables related to the number of national politicians who are democratic or republican in a specific month of the associated year from `r min(pols$year)` to `r max(pols$year)`:

- `year`: year of the count on that row
- `month`: month of the count on that row
- `gov_gop`, `sen_gop`, `rep_gop`: the number of Republican Party representatives in government, Senate, and House, respectively on the associated month and year
- `gov_dem`, `sen_dem`, `rep_dem`: the number of Democratic Party representatives in government, Senate, and House, respectively on the associated month and year
- `president`: political affiliation of the U.S. president on the associated month and year (`dem` = democratic, `gop` = republican)

This dataset contains `r colSums(is.na(pols))` missing values in columns `r colnames(pols)` respectively, indicating no missing values. 


### `unemployment`
`unemployment` (from `unemployment.csv`) contains `r nrow(unemployment)` observations of `r ncol(unemployment)` variables related to percentage of unemployment in a specific month of the associated year from `r min(unemployment$year)` to `r max(unemployment$year)`:

- `year`: year of the measurements on that row
- `month`: month of the count on that row
- `unemployment_rate`: percentage of unemployment of the associated year and month

However, this dataset contains `r colSums(is.na(unemployment))` missing values in columns `r colnames(unemployment)` respectively, corresponding to no records of unemployment rate from July 2015 to December 2015. 


### `snp`
`snp` (from `snp.csv`) contains `r nrow(snp)` observations of `r ncol(snp)` variables related to  Standard & Poorâ€™s stock market index (S&P) in a specific month of the associated year from `r min(snp$year)` to `r max(snp$year)`:

- `year`: year of the measurements on that row
- `month`: month of the measurements on that row
- `close`: the closing values of the S&P stock index on the associated year and month

This dataset contains `r colSums(is.na(snp))` missing values in columns `r colnames(snp)` respectively, indicating no missing values. 


### Merged dataset `result`
`result` includes merged data from `unemployment` and `snp` into `pols`. Therefore, it contains information on political party representation, the closing values of the S&P stock index, and the percentage of unemployment, from January 1947 to June 2015 (same range as `pols`). It includes a total of `r nrow(result)` rows/observations and `r ncol(result)` columns/variables as described above. 


# Problem 2

## Data Wrangling
Mr. Trash Wheel
```{r}
mr_trash = 
  read_excel(
    "data/202409 Trash Wheel Collection Data.xlsx", 
    sheet = "Mr. Trash Wheel",
    range = "A2:N653"
    ) |> 
  janitor::clean_names() |> 
  # no need date
  select(-date) |> 
  # add name of the wheel
  mutate(
    wheel = "mr"
  ) |> 
  # round sports balls to the nearest integer and converts the result to an integer variable 
  mutate(sports_balls = as.integer(round(sports_balls))) |> 
  # pivot the data longer for types of trash
  pivot_longer(
    cols = plastic_bottles:sports_balls,
    names_to = "trash_type",
    values_to = "count"
  ) |> 
  # pivot the data longer for weight and volume 
  pivot_longer(
    cols = weight_tons:volume_cubic_yards,
    names_to = "measurement_type",
    values_to = "value"
  ) |> 
  # move homes to the last column 
  relocate(homes_powered, .after = last_col()) |> 
  # convert year and month to integer and factor
  mutate(
    month = str_to_title(month),
    month = factor(month, levels = month.name),
    year = as.integer(year)
  )
mr_trash
filter(mr_trash, is.na(year) | is.na(month))
```
Professor Trash Wheel 
```{r}
prof_trash = 
  read_excel(
    "data/202409 Trash Wheel Collection Data.xlsx", 
    sheet = "Professor Trash Wheel",
    range = "A2:M121"
    ) |> 
  janitor::clean_names() |> 
  # no need date
  select(-date) |> 
  # add name of the wheel
  mutate(
    wheel = "prof"
  ) |> 
  # pivot the data longer for types of trash
  pivot_longer(
    cols = plastic_bottles:wrappers,
    names_to = "trash_type",
    values_to = "count"
  ) |> 
  # pivot the data longer for weight and volume 
  pivot_longer(
    cols = weight_tons:volume_cubic_yards,
    names_to = "measurement_type",
    values_to = "value"
  ) |> 
  # move homes to the last column 
  relocate(homes_powered, .after = last_col()) |> 
  # convert year and month to integer and factor
  mutate(
    month = str_to_title(month),
    month = factor(month, levels = month.name),
    year = as.integer(year)
  ) |> 
  # only keep non-empty rows
  filter(!is.na(year))

prof_trash
```

Gwynnda
```{r}
gwy_trash = 
  read_excel(
    "data/202409 Trash Wheel Collection Data.xlsx", 
    sheet = "Gwynnda Trash Wheel",
    range = "A2:L265"
    ) |> 
  janitor::clean_names() |> 
  # no need date
  select(-date) |> 
  # add name of the wheel
  mutate(
    wheel = "gwy"
  ) |> 
  # pivot the data longer for types of trash
  pivot_longer(
    cols = plastic_bottles:wrappers,
    names_to = "trash_type",
    values_to = "count"
  ) |> 
  # pivot the data longer for weight and volume 
  pivot_longer(
    cols = weight_tons:volume_cubic_yards,
    names_to = "measurement_type",
    values_to = "value"
  ) |> 
  # move homes to the last column 
  relocate(homes_powered, .after = last_col()) |> 
  # convert year and month to integer and factor
  mutate(
    month = str_to_title(month),
    month = factor(month, levels = month.name),
    year = as.integer(year)
  )
gwy_trash
```

Combine this with the 3 wheel datasets 
```{r}
wheels = 
  bind_rows(mr_trash, prof_trash, gwy_trash) |> 
  # move wheel, year, month as leading columns 
  relocate(wheel, year, month)
```


## Description about `wheels` 
*Write a paragraph about these data; you are encouraged to use inline R. Be sure to note the number of observations in the resulting dataset, and give examples of key variables.*

The `wheels` contains trash collection data of 3 wheels: Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda Trash Wheel, from `r min(wheels$year)` to `r max(wheels$year)`. It includes a total of `r nrow(wheels)` observations of `r ncol(wheels)` variables. Each row/observation indicates the trash collection information of a specific wheel's dumpster in a month and a year such as amount of total litter and litter type, and number of homes powered by the trash collected.

Key variables include:

- `wheel`: wheel identifier indicating which wheel the trash was collected from (`mr` = Mr. Trash, `prof` = Professor, `gwy` = Gwynnda)
- `year`: year the data was collected
- `month`: month the data was collected
- `dumpster`: dumpster number (in integer, starting from 1)
- `trash_type`: type of trash collected, including `plastic_bottles`, `polystyrene`, `cigarette_butts`, `glass_bottles`, `plastic_bags`, `wrappers`, `sports_balls`
- `count`: counts of how many of a specific trash type was collected (in integer)
- `measurement_type`: type of measurement of total trash collected (such as weight in tons (`weight_tons`) or volume in cubic yards (`volume_cubic_yards`))
- `value`: numeric value of a specific measurement type of total trash collected


*What was the total weight of trash collected by Professor Trash Wheel?*
```{r}
prof_total_weight = 
  filter(
    wheels, 
    wheel == "prof", 
    measurement_type == "weight_tons"
  ) |> 
  select(value) |> 
  sum()
```
The total weight of trash collected by Professor Trash Wheel is `r prof_total_weight` tons. 

*What was the total number of cigarette butts collected by Gwynnda in June of 2022?*
```{r}
gwy_jun22_cig = 
  filter(
    wheels, 
    wheel == "gwy", 
    trash_type == "cigarette_butts",
    year == 2022,
    month == "June"
  ) |> 
  select(count) |> 
  sum()
```
The total number of cigarette butts collected by Gwynnda in June of 2022 is `r gwy_jun22_cig`.

# Problem 3
## Data Wrangling




# Question
1. no dumpster
2. left_join prob1?